((self||this)["webpackJsonp@sprinklrjs/chat-web-client"]=(self||this)["webpackJsonp@sprinklrjs/chat-web-client"]||[]).push([[58],{1063:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(191),c=r.n(n);var a=class{constructor(){this._map=void 0,this._map={}}addEntry(e){this._map[e]||(this._map[e]={subscribers:[],variants:[]})}setAction(e,t){const r=(e=>{const t=e.indexOf("_");return-1!==t?e.substring(0,t):e})(e),n=Date.now();this.addEntry(r),this._map[r].variants=[...this._map[r].variants,{actionState:t,actionTime:n,id:e}],this._map[r].subscribers.forEach((e=>{e(t)})),this._map[r].subscribers=[]}setSubscriber(e,t){return this.addEntry(e),this._map[e].subscribers.push(t),()=>{this._map[e].subscribers=this._map[e].subscribers.filter((e=>e!==t))}}getActionState(e,t){const r=this._map[e]&&this._map[e].variants;if(r&&r.length){const e=r.find((e=>e.id===t));return t?e&&e.actionState:r[r.length-1].actionState}}getActionDetails(){return this._map}},s=r(192);const i=c.a.createContext(void 0);t.b=e=>{let{children:t}=e;const r=Object(n.useRef)(new a);return Object(s.jsx)(i.Provider,{value:r.current},t)}},1354:function(e,t,r){var n=r(88),c=r(598),a=r(697),s=r(56),i=r(57),u=r(89),o=Math.min;e.exports=function(e,t,r){for(var l=r?a:c,b=e[0].length,O=e.length,d=O,E=Array(O),T=1/0,v=[];d--;){var _=e[d];d&&t&&(_=s(_,i(t))),T=o(_.length,T),E[d]=!r&&(t||b>=120&&_.length>=120)?new n(d&&_):void 0}_=e[0];var I=-1,j=E[0];e:for(;++I<b&&v.length<T;){var f=_[I],h=t?t(f):f;if(f=r||0!==f?f:0,!(j?u(j,h):l(v,h,r))){for(d=O;--d;){var C=E[d];if(!(C?u(C,h):l(e[d],h,r)))continue e}j&&j.push(h),v.push(f)}}return v}},1355:function(e,t,r){var n=r(94);e.exports=function(e){return n(e)?e:[]}},1483:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return qt}));var n=r(191),c=r.n(n),a=r(293),s=r.n(a),i=r(192),u=r(31),o=r.n(u),l=r(273),b=r.n(l),O=r(360),d=r.n(O),E=r(290),T=r.n(E),v=r(48),_=r.n(v),I=r(421),j=r.n(I),f=r(260),h=r(881),C=r(507),g=r(485),p=r(52),m=r(307);const S="IDLE",R="TRACKING";var N=()=>{const{subscribe:e}=Object(g.a)(),t=Object(n.useCallback)((()=>({eventType:m.a.PAGE_VISIT,eventId:c.current,details:{title:Object(p.c)(),oldUrl:c.current,newUrl:a.current}})),[]),r=Object(h.useFirstMountState)(),c=Object(n.useRef)(""),a=Object(n.useRef)(Object(p.b)()),{loading:s,refetch:i}=Object(C.a)({payload:t(),skipQueryOnMount:!1});return Object(n.useEffect)((()=>{const r=e("pageVisitTrackerInPrompt",(e=>{let{currentUrl:r,previousUrl:n}=e;c.current=n,a.current=r,i(t())}));return()=>{r&&r()}}),[i]),{trackingStatus:r||s?R:S}},A=r(9);var L=()=>{const{refetch:e}=Object(C.a)({skipQueryOnMount:!0});Object(n.useEffect)((()=>{const t=()=>{e({eventType:m.a.TAB_CHANGE,eventId:Object(p.b)(),details:{isActive:Object(A.d)()}})};return document.addEventListener("visibilitychange",t),()=>{document.removeEventListener("visibilitychange",t)}}),[e])};var y=()=>{const{refetch:e}=Object(C.a)({skipQueryOnMount:!0});Object(n.useEffect)((()=>{const t=()=>{e({eventType:m.a.TAB_CLOSE,eventId:Object(p.b)(),details:{}})};return window.addEventListener("beforeunload",t),()=>{window.removeEventListener("beforeunload",t)}}),[e])};var D=()=>(L(),y(),N()),k=r(363),U=r(223),P=r(240),V=r(321),w=r(1),G=r(297),M=r(377),x=r.n(M),H=r(352),F=r(547),W=r(304),$=r(303),B=r(364),Q=r(236);const Z={filterType:W.a.IN,field:$.a.INITIATE_OUTGOING_CALL,values:[!0]},Y=e=>{let{filter:t,field:r}=e;return!!t&&(t.filters?x()(t.filters,(e=>Y({filter:e,field:r}))):t.field===r)},z=e=>{const t=H.a.getFilter(e),r=H.a.getSnoozeConfig(e);if(o()(r)||Y({filter:e.filter,field:$.a.NUM_SNOOZE_ALLOWED}))return e;const n={filterType:W.a.LTE,field:$.a.NUM_SNOOZE_ALLOWED,values:[r.maxSnoozeCount],details:{numSnoozes:r.maxSnoozeCount-r.currentSnoozeCount,nextSnoozeDuration:r.nextSnoozeDuration}};return t?{...e,filter:{filterType:W.a.AND,filters:[n,t]}}:{...e,filter:n}},K=(e,t)=>x()(e.targets,(e=>{let{type:r}=e;return r===t})),X=e=>{const t=K(e,B.a.AUDIO_CALL),r=K(e,B.a.VIDEO_CALL),n=e.filter;if(!t&&!r||Y({filter:n,field:$.a.INITIATE_OUTGOING_CALL}))return e;const c={...Z,details:{callTypes:[...Object(F.a)(t,Q.c.AUDIO),...Object(F.a)(r,Q.c.VIDEO)]}};return n?{...e,filter:{filterType:W.a.AND,filters:[c,n]}}:{...e,filter:c}},J=(new U.a).setUrl("/livechat/prompt/candidatePrompts").setType(P.a.POST).build(),q="ADD",ee="REMOVE",te="RESET",re=e=>_()(e,(e=>{const t=j()(z,X)(e);return{...t,filter:Object(G.a)(t.filter,t.id)}}));var ne=()=>{const{data:e,refetch:t,fetchMore:r,updateQuery:c}=Object(f.a)({query:J,skipQueryOnMount:!0,mapFn:re}),a=D().trackingStatus===S,[s,i]=Object(n.useState)(a?void 0:{isSilent:!1}),u=Object(k.a)(),o=Object(n.useRef)(a);o.current=a;const l=Object(n.useCallback)((e=>{if(!o.current)return i({isSilent:e}),null;return t({...Object(p.a)(),appId:Object(w.a)().appId},e?(e,t)=>b()(t,(e=>{const t=u.getActionState(e.interceptId,e.id);return t!==V.a.CLOSE&&t!==V.a.ENGAGE&&t!==V.a.SNOOZE})):void 0)}),[t]),O=Object(n.useCallback)((e=>o.current?r({...Object(p.a)(),appId:Object(w.a)().appId,...e},((e,t)=>d()([...e,...t],"id"))):(i({isSilent:!1}),null)),[]);Object(n.useEffect)((()=>{a&&s&&(l(s.isSilent),i(void 0))}),[a,s]);return[e,Object(n.useCallback)((e=>{switch(e.type){case q:return O(e.payload);case ee:{const t=new Set(T()(e.payload.interceptIds));return c((e=>b()(e,(e=>!t.has(H.a.getId(e)))))),null}case te:return l(e.payload.silent);default:return null}}),[c])]},ce=r(745),ae=r(664),se=r(274),ie=r(262);const ue=e=>`PROMPT_${se.a.getId(e)}_${Date.now()}_${Math.random().toString(16).substr(2,8)}`;let oe;const le=()=>oe,be=()=>{le().disconnect().then((()=>{Object(ie.a)("MQTT Client | Disconnected")})).catch((e=>{console.error("MQTT Client | Disconnection Error",e)}))};var Oe=r(199),de=r(374);const Ee="ADD_INTERCEPT",Te="REMOVE_INTERCEPT";var ve=(e,t)=>{const r=Object(n.useMemo)((()=>({chatUser:de.a.getChatUser(t),userName:de.a.getChatSessionToken(t),inboxServerUrl:de.a.getProactiveInboxServerUrl(t),userInbox:de.a.getProactiveUserInbox(t)})),[t.chatUser,t.chatSessionToken,t.proactivePromptInboxServerUrl,t.proactiveUserInbox]);Object(n.useEffect)((()=>{(e=>{let{chatUser:t,userName:r,inboxServerUrl:n,userInbox:c}=e;const a=ue(t);oe=new ae.a({userName:r,clientId:a,inboxServerUrl:n,userInbox:c})})(r);try{(()=>{le().connect().catch((e=>{console.error("MQTT Client | Connection Error",e)}));const e=le();e.on("error",(()=>{Object(ie.a)("MQTT Client | Error")})),e.on("offline",(()=>{Object(ie.a)("MQTT Client | Offline")})),e.on("reconnect",(()=>{Object(ie.a)("MQTT Client | Reconnect")})),e.on("close",(()=>{Object(ie.a)("MQTT Client | Closed")}))})(),le().subscribe().catch((e=>{console.error("MQTT client | Subscribe Error",e)})),le().on("message",((t,r)=>{try{const t=JSON.parse(r.toString());e(t)}catch(n){Object(Oe.b)(n)}}))}catch(t){Object(Oe.b)(t),be()}return()=>{try{le().unsubscribe()}catch(e){Object(Oe.b)(e)}finally{be()}}}),[r,e])},_e=r(217),Ie=r.n(_e),je=r(603);const fe=c.a.createContext({debug:Ie.a,info:Ie.a,warning:Ie.a,error:Ie.a}),he=e=>{let{children:t}=e;const r=Object(ce.a)().chatUser,n=se.a.getId(r),c=Object(je.a)({category:"PROACTIVE_PROMPT",userId:n,batch:!0});return Object(i.jsx)(fe.Provider,{value:c},t)},Ce=()=>Object(n.useContext)(fe);var ge=r(244);var pe=()=>{const{subscribe:e}=Object(g.a)(),t=Object(ce.a)(),[r,c]=ne(),a=Ce(),s=Object(w.b)();Object(n.useEffect)((()=>{c({type:te,payload:{}})}),[c,t]);const i=Object(n.useCallback)((e=>{switch(e.payload.type){case Ee:c({type:q,payload:{variables:e.payload.variables}});break;case Te:c({type:ee,payload:{interceptIds:e.payload.interceptIds}})}}),[c]);return ve(i,t),Object(n.useEffect)((()=>{const t=e("fetchCandidatePromptBaseOnUrlChange",(()=>{c({type:te,payload:{silent:!0}})}));return()=>{t&&t()}}),[c]),Object(n.useEffect)((()=>{const e=e=>{if(e.response&&e.response.data&&e.response.data.eventType===ge.a.USER_PROFILE_UPDATED.id)return c({type:te,payload:{silent:!0}})};return s.sprChat("subscribeToUpdate",{topic:"eventTriggered",subscriber:e}),()=>{s.sprChat("unsubscribeToUpdate",{topic:"eventTriggered",subscriber:e})}}),[c]),Object(n.useEffect)((()=>{const e=b()(r,(e=>!H.a.getCreativeId(e)));o()(e)||a.debug(`Available intercepts : ${JSON.stringify(e)}`)}),[r]),[r,c]},me=r(968),Se=r.n(me),Re=r(15),Ne=r.n(Re),Ae=r(339),Le=r.n(Ae);const ye=new Set([$.a.IS_CONVERSATION_OPEN,$.a.INITIATE_OUTGOING_CALL]),De="EXCLUDE_LIVE_CHAT_FILTERS",ke="INCLUDE_LIVE_CHAT_FILTERS",Ue=(e,t)=>{if(!o()(e)){if(e.filterType===W.a.AND||e.filterType===W.a.OR){if(o()(e.filters))return;const r=Le()(_()(e.filters,(e=>Ue(e,t))));return o()(r)?void 0:{...e,filters:r}}return t===ke&&ye.has(e.field)||t===De&&!ye.has(e.field)?e:void 0}};var Pe=r(882),Ve=r(231);var we=()=>{const{subscribe:e,getValue:t}=Object(g.a)();return{subscribe:Object(n.useCallback)(((t,r)=>{const n=Ve.a.getId(t);return e(n,r)}),[e]),getValue:t}},Ge=r(1065),Me=r(216),xe=r.n(Me),He=r(230),Fe=r.n(He),We=r(8),$e=r.n(We),Be=r(50),Qe=r.n(Be);var Ze=class{constructor(){this._startTime=void 0,this._endTime=void 0,this.start=()=>(this._startTime=this.getCurrentTime(),this._startTime),this.stop=()=>(this._endTime=this.getCurrentTime(),this._endTime),this.getCurrentTime=()=>Date.now(),this.getStartTime=()=>this._startTime,this.getEndTime=()=>this._endTime,this._startTime=0,this._endTime=0}};var Ye=class{constructor(){this._clockInstance=void 0,this._activeTime=void 0,this._visibilityChangeHandler=()=>{const e=Object(A.d)();e||(this._clockInstance.stop(),this._activeTime+=this._clockInstance.getEndTime()-this._clockInstance.getStartTime()),e&&this._clockInstance.start()},this.time=()=>Object(A.d)()?this._activeTime+(this._clockInstance.getCurrentTime()-this._clockInstance.getStartTime()):this._activeTime,this._clockInstance=new Ze,Object(A.d)()&&this._clockInstance.start(),this._activeTime=0,document.addEventListener("visibilitychange",this._visibilityChangeHandler)}};var ze=()=>Object(n.useCallback)((e=>{let{startTime:t,expectedTime:r,onTimeout:n}=e;const c=r-(t||Date.now());let a;return c>0&&(a=window.setTimeout((()=>{n()}),c)),a}),[]);var Ke=()=>{const e=ze(),t=Object(n.useRef)();t.current=Object(n.useMemo)((()=>new Ye),[]);const r=Object(n.useRef)({}),c=Object(n.useCallback)((()=>{const n=Object(A.d)();n&&Qe()(r.current,((n,c)=>{const{onChangeCallback:a}=n,s=e({startTime:t.current.time(),expectedTime:Fe()(Ve.a.getValues($e()(n,"filter"))),onTimeout:a});s&&(r.current={...r.current,[c]:{...r.current[c],timeoutId:s}})})),n||Qe()(r.current,(e=>{const{timeoutId:t}=e;t&&window.clearTimeout(t)}))}),[]);Object(n.useEffect)((()=>(document.addEventListener("visibilitychange",c),()=>{document.removeEventListener("visibilitychange",c)})),[]);return{subscribe:Object(n.useCallback)(((n,c)=>{const a=Ve.a.getId(n),s=Object(A.d)();if(s){const s=e({startTime:t.current.time(),expectedTime:Fe()(Ve.a.getValues(n)),onTimeout:c});s&&(r.current={...r.current,[a]:{timeoutId:s,filter:n,onChangeCallback:c}})}return s||(r.current={...r.current,[a]:{filter:n,onChangeCallback:c}}),()=>{clearTimeout($e()(r.current,`${a}.timeoutId`)),r.current=xe()(r.current,a)}}),[]),getValue:Object(n.useCallback)((()=>t.current.time()),[])}};var Xe=class{constructor(){this._clockInstance=void 0,this._inactiveTime=void 0,this._visibilityChangeHandler=()=>{const e=Object(A.d)();e||this._clockInstance.start(),e&&(this._clockInstance.stop(),this._inactiveTime+=this._clockInstance.getEndTime()-this._clockInstance.getStartTime())},this.time=()=>Object(A.d)()?this._inactiveTime:this._inactiveTime+(this._clockInstance.getCurrentTime()-this._clockInstance.getStartTime()),this._clockInstance=new Ze,Object(A.d)()||this._clockInstance.start(),this._inactiveTime=0,document.addEventListener("visibilitychange",this._visibilityChangeHandler)}};var Je=()=>{const e=ze(),t=Object(n.useRef)();t.current=Object(n.useMemo)((()=>new Xe),[]);const r=Object(n.useRef)({}),c=Object(n.useCallback)((()=>{const n=Object(A.d)();n&&Qe()(r.current,(e=>{const{timeoutId:t}=e;t&&window.clearTimeout(t)})),n||Qe()(r.current,((n,c)=>{const{onChangeCallback:a}=n,s=e({startTime:t.current.time(),expectedTime:Fe()(Ve.a.getValues($e()(n,"filter"))),onTimeout:a});s&&(r.current={...r.current,[c]:{...r.current[c],timeoutId:s}})}))}),[]);Object(n.useEffect)((()=>(document.addEventListener("visibilitychange",c),()=>{document.removeEventListener("visibilitychange",c)})),[]);return{subscribe:Object(n.useCallback)(((n,c)=>{const a=Ve.a.getId(n),s=Object(A.d)();if(!s){const s=e({startTime:t.current.time(),expectedTime:Fe()(Ve.a.getValues(n)),onTimeout:c});s&&(r.current={...r.current,[a]:{timeoutId:s,filter:n,onChangeCallback:c}})}return s&&(r.current={...r.current,[a]:{filter:n,onChangeCallback:c}}),()=>{clearTimeout($e()(r.current,`${a}.timeoutId`)),r.current=xe()(r.current,a)}}),[]),getValue:Object(n.useCallback)((()=>t.current.time()),[])}};const qe=(e,t)=>Ne()(e,((e,r,n)=>{const c=r.variants.filter((e=>e.actionState===t));return o()(c)||(r.variants=c,e[n]=r),e}),{});var et=()=>{const e=Object(n.useRef)({}),t=Object(k.a)();return{subscribe:Object(n.useCallback)(((r,n)=>{const c=Ve.a.getId(r),a=Fe()(Ve.a.getValues(r));if(!t.getActionState(a)){const r=t.setSubscriber(a,(e=>{e===V.a.ENGAGE&&n()}));e.current={...e.current,[c]:{unsubscribeInterceptActionEvent:r}}}return()=>{const t=$e()(e.current,`${c}.unsubscribeInterceptActionEvent`);t&&t(),e.current=xe()(e.current,c)}}),[]),getValue:Object(n.useCallback)((()=>qe(t.getActionDetails(),V.a.ENGAGE)),[])}};var tt=()=>{const e=Object(n.useRef)({}),t=Object(k.a)();return{subscribe:Object(n.useCallback)(((r,n)=>{const c=Ve.a.getId(r),a=Fe()(Ve.a.getValues(r));if(!t.getActionState(a)){const r=t.setSubscriber(a,(e=>{e===V.a.CLOSE&&n()}));e.current={...e.current,[c]:{unsubscribeInterceptActionEvent:r}}}return()=>{const t=$e()(e.current,`${c}.unsubscribeInterceptActionEvent`);t&&t(),e.current=xe()(e.current,c)}}),[]),getValue:Object(n.useCallback)((()=>qe(t.getActionDetails(),V.a.CLOSE)),[])}};var rt=()=>{const{getValue:e,subscribe:t}=et(),{getValue:r,subscribe:c}=tt(),a=Object(n.useRef)({});return{subscribe:Object(n.useCallback)(((t,n,c)=>{const s=Ve.a.getId(t);switch(c&&Ve.a.getField(c)){case $.a.INTERCEPT_CLOSED_IN_SESSION_KEY:{const e=r(),i=Fe()(Ve.a.getValues(c)),u=()=>{const r=Fe()(Ve.a.getValues(t)),c=e[i]?e[i].variants:[],u=c[c.length-1].actionTime,o=r-(Date.now()-u);let l;o>0&&(l=window.setTimeout((()=>{n()}),o),a.current={...a.current,[s]:[()=>clearTimeout(l)]})};e[i]&&u();break}case $.a.INTERCEPT_ENGAGED_IN_SESSION_KEY:{const r=e(),i=Fe()(Ve.a.getValues(c)),u=()=>{const e=Fe()(Ve.a.getValues(t)),c=r[i]?r[i].variants:[],u=c[c.length-1].actionTime,o=e-(Date.now()-u);let l;o>0&&(l=window.setTimeout((()=>{n()}),o),a.current={...a.current,[s]:[()=>clearTimeout(l)]})};r[i]&&u();break}}return()=>{_()(a.current[s],(e=>e())),a.current=xe()(a.current,s)}}),[])}},nt=r(883),ct=r(885);var at=class{constructor(){this._clockInstance=void 0,this._totalTime=void 0,this.time=()=>(this._totalTime=this._clockInstance.getCurrentTime()-this._clockInstance.getStartTime(),this._totalTime),this._clockInstance=new Ze,this._totalTime=0,this._clockInstance.start()}};var st=r(272),it=r.n(st);var ut=()=>{const e=Object(n.useRef)({});return{subscribe:Object(n.useCallback)(((t,r)=>{const n=Ve.a.getId(t),{start:c,end:a}=$e()(t,"details.range[0]");let s,i;const u=c,o=it()(a)?-1:a;return u>0&&(s=window.setTimeout(r,u)),o>0&&(i=window.setTimeout(r,o)),e.current={...e.current,[n]:{...e.current[n],timeoutIdToGetInRange:s,timeoutIdToGetOutFromRange:i,timerStartTime:Date.now()}},()=>{clearTimeout($e()(e.current,`${n}.timeoutIdToGetInRange`)),clearTimeout($e()(e.current,`${n}.timeoutIdToGetOutFromRange`)),e.current=xe()(e.current,n)}}),[]),getValue:Object(n.useCallback)((()=>t=>{const r=Ve.a.getId(t),{start:n,end:c}=$e()(t,"details.range[0]"),a=$e()(e.current,`${r}.timerStartTime`),s=Date.now()-a;return it()(n)||it()(c)?it()(n)||s>=n?0:1:s>=c?1:s>=n?0:1}),[])}};var ot=e=>{const t=Object(n.useRef)({});Object(n.useEffect)((()=>{var e;const r=()=>{_()(t.current,(e=>{e()}))},n=window.screen;return null===n||void 0===n||null===(e=n.addEventListener)||void 0===e||e.call(n,"change",r),()=>{var e;null===n||void 0===n||null===(e=n.removeEventListener)||void 0===e||e.call(n,"change",r)}}),[]);const r=Object(n.useCallback)(((e,r)=>{const n=e.id;return t.current={...t.current,[n]:r},()=>{t.current=xe()(t.current,n)}}),[]);return{getValue:Object(n.useCallback)((()=>window.screen[e]),[]),subscribe:r}};var lt=()=>{const{getValue:e,subscribe:t}=we(),{getValue:r,subscribe:c}=Object(Ge.a)(),{getValue:a,subscribe:s}=Ke(),{getValue:i,subscribe:u}=Je(),{getValue:o,subscribe:l}=tt(),{getValue:b,subscribe:O}=et(),{subscribe:d}=rt(),{getValue:E,subscribe:T}=Object(nt.a)(),{getValue:v,subscribe:_}=Object(ct.a)(),{getValue:I,subscribe:j}=(()=>{const e=Object(n.useRef)({});return{subscribe:Object(n.useCallback)(((t,r)=>{const n=Ve.a.getId(t),c=Fe()(Ve.a.getValues(t));let a;return c>0&&(a=window.setTimeout((()=>{e.current={...e.current,[n]:{...e.current.id,timeLeft:0}},r()}),c)),e.current={...e.current,[n]:{timeoutId:a,timeLeft:c}},()=>{window.clearTimeout($e()(e.current,`${n}.timeoutId`)),e.current=xe()(e.current,n)}}),[]),getValue:Object(n.useCallback)((()=>t=>{const r=Ve.a.getId(t);return $e()(e.current,`${r}.timeLeft`,0)}),[])}})(),{getValue:f,subscribe:h}=(()=>{const e=ze(),t=Object(n.useRef)(new at),r=Object(n.useRef)({});return{subscribe:Object(n.useCallback)(((n,c)=>{const a=Ve.a.getId(n),s=$e()(Ve.a.getDetails(n),"nextSnoozeDuration",0),i=t.current.time(),u=e({startTime:i,expectedTime:i+s,onTimeout:()=>{r.current={...r.current,[a]:{...r.current.id,timeLeft:0}},c()}});return u&&(r.current={...r.current,[a]:{timeoutId:u,timeLeft:s}}),()=>{clearTimeout($e()(r.current,`${a}.timeoutId`)),r.current=xe()(r.current,a)}}),[]),getValue:Object(n.useCallback)((()=>e=>{const t=Ve.a.getId(e);return $e()(r.current,`${t}.timeLeft`,0)}),[])}})(),{getValue:C,subscribe:g}=ut(),{getValue:p,subscribe:m}=ot("width"),{getValue:S,subscribe:R}=ot("height");return{getValue:Object(n.useCallback)((()=>({[$.a.CURRENT_URL]:e(),[$.a.TOTAL_TIME_SPENT]:r(),[$.a.ACTIVE_TIME_SPENT]:a(),[$.a.INACTIVE_TIME_SPENT]:i(),[$.a.INTERCEPT_ENGAGED_IN_SESSION_KEY]:b(),[$.a.INTERCEPT_CLOSED_IN_SESSION_KEY]:o(),[$.a.VERTICAL_PAGE_SCROLL_DEPTH]:E(),[$.a.HORIZONTAL_PAGE_SCROLL_DEPTH]:v(),[$.a.TIME_SPENT_ON_SESSION]:I(),[$.a.NUM_SNOOZE_ALLOWED]:f(),[$.a.BUSINESS_HOURS]:C(),[$.a.SCREEN_RESOLUTION_WIDTH]:p(),[$.a.SCREEN_RESOLUTION_HEIGHT]:S()})),[e,r,a,i,o,b,E,v,I,f,C,p,S]),subscribe:Object(n.useCallback)(((e,r,n)=>{switch(Ve.a.getField(e)){case $.a.TOTAL_TIME_SPENT:return c(e,r);case $.a.CURRENT_URL:return t(e,r);case $.a.ACTIVE_TIME_SPENT:return s(e,r);case $.a.INACTIVE_TIME_SPENT:return u(e,r);case $.a.INTERCEPT_CLOSED_IN_SESSION_KEY:return l(e,r);case $.a.INTERCEPT_ENGAGED_IN_SESSION_KEY:return O(e,r);case $.a.DEPENDENT_DURATION_KEY:return d(e,r,n);case $.a.VERTICAL_PAGE_SCROLL_DEPTH:return T(e,r);case $.a.HORIZONTAL_PAGE_SCROLL_DEPTH:return _(e,r);case $.a.TIME_SPENT_ON_SESSION:return j(e,r);case $.a.NUM_SNOOZE_ALLOWED:return h(e,r);case $.a.BUSINESS_HOURS:return g(e,r);case $.a.SCREEN_RESOLUTION_WIDTH:return m(e,r);case $.a.SCREEN_RESOLUTION_HEIGHT:return R(e,r);default:return Ie.a}}),[t,c,s,u,l,O,d,T,_,j,h,g])}},bt=r(229);var Ot=(e,t)=>{const{getValue:r,subscribe:c}=lt(),a=Object(n.useCallback)((()=>{var e,n;return{...null!==(e=null===t||void 0===t||null===(n=t._getStaticValueMap)||void 0===n?void 0:n.call(t))&&void 0!==e?e:bt.a,...r()}}),[r,null===t||void 0===t?void 0:t._getStaticValueMap]);return Object(Pe.a)(e,{...t,getValue:a,subscribe:c})},dt=r(277),Et=r.n(dt);var Tt=e=>{const[t,r]=Object(n.useState)(0),c=Object(n.useRef)([]),a=Object(n.useRef)({}),s=Object(w.b)();return Object(n.useMemo)((()=>{o()(e)?c.current=[{hasPassed:!0}]:c.current=_()(e,(e=>{let{id:t,filter:r}=e;const n=o()(r)||a.current[t];return delete a.current[t],{hasPassed:n}}))}),[e]),Object(n.useEffect)((()=>{if(!o()(Le()(_()(e,"filter")))){const t=Et.a.v4(),n=t=>{let{data:n}=t;n&&(c.current=_()(e,((e,t)=>{var r,c;let{id:s,filter:i}=e;return a.current[s]=!i||(null===(r=n.results)||void 0===r||null===(c=r[t])||void 0===c?void 0:c.passed),{hasPassed:a.current[s]}})),r((e=>e+1)))};return s.sprChat("addFilterToEvaluate",{id:t,filters:_()(e,"filter")},n),()=>{s.sprChat("removeFilterToEvaluate",{id:t})}}}),[e]),c.current};var vt=e=>{const t=Object(n.useRef)([]),r=Ce(),{interceptsWithoutLiveChatFilterToEvaluate:c,interceptsOnlyWithLiveChatFilterToEvaluate:a}=Object(n.useMemo)((()=>Ne()(e,((e,t)=>{const r=Ue(H.a.getFilter(t),De),n=Ue(H.a.getFilter(t),ke);return{interceptsWithoutLiveChatFilterToEvaluate:[...e.interceptsWithoutLiveChatFilterToEvaluate,r],interceptsOnlyWithLiveChatFilterToEvaluate:[...e.interceptsOnlyWithLiveChatFilterToEvaluate,{id:H.a.getId(t),filter:n}]}}),{interceptsWithoutLiveChatFilterToEvaluate:[],interceptsOnlyWithLiveChatFilterToEvaluate:[]})),[e]),s=Ot(c,{defaultValue:!0}),i=Tt(a);return Object(n.useMemo)((()=>{t.current=[],_()(e,((e,r)=>{s[r].hasPassed&&i[r].hasPassed&&(t.current=[...t.current,e])}))}),[s,i,e]),Object(n.useEffect)((()=>{const e=b()(t.current,(e=>!H.a.getCreativeId(e)));o()(e)||r.debug(`filterPassedIntercepts : ${JSON.stringify(e)}`)}),[t.current]),t.current};const _t=(e,t)=>t?Ne()(H.a.getTargets(e),((e,r,n)=>({...e,[n]:{...r,additional:t[r.value]}})),{}):H.a.getTargets(e);var It=r(266);const jt="/livechat/prompt";async function ft(e){return(await It.a.post(`${jt}/fetch/survey`,e)).data}const ht=["snoozeConfig"];var Ct=e=>{const[t,r]=Object(n.useState)(0),c=Object(n.useRef)([]),a=Object(n.useRef)({}),s=Object(n.useRef)({}),i=Ce();return Object(n.useMemo)((()=>{c.current=[],_()(e,(e=>{if(!e)return;if(!e.creativeId)return void i.debug(`Intercept resolver : ${JSON.stringify(e)}`);if(!o()(a.current[e.id]))return void c.current.push({...e,...xe()(a.current[e.id],ht)});const t=(e=>{const t=H.a.getId(e),r=Ne()(H.a.getTargets(e),((e,t)=>t.type===B.a.SURVEY||t.type===B.a.SURVEY_INLINE?{...e,surveyURLs:e.surveyURLs?[...e.surveyURLs,t.value]:[t.value]}:e),{});return o()(r)?void 0:{...r,variantId:t}})(e);s.current[e.creativeId]||(s.current[e.creativeId]=async function(e){return(await It.a.post(`${jt}/creative/${e}`)).data}(e.creativeId)),Promise.all([s.current[e.creativeId],t?ft(t):Promise.resolve(void 0)]).then((t=>{let[n,s]=t;const i={...e,creative:n,targets:_t(e,s)};a.current[e.id]=i,c.current=[...c.current,i],r((e=>e+1))})).catch((e=>{Object(Oe.b)(e)}))}))}),[e,r]),c.current};var gt=e=>{const t=Object(n.useRef)([]),r=vt(e),c=Ct(r);return Object(n.useMemo)((()=>{t.current=d()([...Se()(t.current,c,"id"),...c],"id")}),[c]),t.current},pt=r(508);const mt=new Set([B.a.LIVE_CHAT_EXECUTE_RULE,B.a.LIVE_CHAT_ROUTE_TO_BOT,B.a.LIVE_CHAT_WITH_AGENT,B.a.CHAT_WITH_AGENT,B.a.ROUTE_TO_BOT,B.a.EXECUTE_RULE,B.a.AUDIO_CALL,B.a.VIDEO_CALL]);var St=e=>{const[t,r]=Object(n.useState)([]),c=Object(w.b)();return Object(n.useEffect)((()=>{const t=t=>{const n=t?e:(e=>Ne()(e,((e,t)=>{let r=!1;return Qe()(H.a.getTargets(t),(e=>{if(mt.has(pt.a.getType(e)))return r=!0,!1})),r?e:[...e,t]}),[]))(e);r((e=>d()([...Se()(e,n,"id"),...n],"id")))};return c.sprChat("onAvailabilityChange",t),()=>{c.sprChat("offAvailabilityChange",t)}}),[r,e,c]),t};const Rt="REMOVE_INTERCEPT";var Nt=function(){const[e,t]=pe(),r=gt(e);return[St(r),Object(n.useCallback)((e=>{e.type===Rt&&t({type:ee,payload:{interceptIds:[e.payload.interceptId]}})}),[])]},At=r(200),Lt=r(746),yt=r(211);const Dt="POPUP",kt="LIVECHAT",Ut="POSITIONED_POPUP",Pt=Object(yt.a)((()=>r.e(55).then(r.bind(null,1513)))),Vt=Object(yt.a)((()=>r.e(56).then(r.bind(null,1501)))),wt=Object(yt.a)((()=>r.e(46).then(r.bind(null,1514)))),Gt=new Set([Dt,kt,Ut]),Mt=e=>{const{intercepts:t}=e,r=Object(n.useMemo)((()=>Ne()(t,((e,t)=>{const r=Lt.a.getType(H.a.getCreative(t));return Gt.has(r)&&e[r].push(t),e}),{[Dt]:[],[kt]:[],[Ut]:[]})),[t]),a=r[Dt],s=r[Ut],u=r[kt];return Object(i.jsx)(c.a.Fragment,null,o()(s)?null:Object(i.jsx)(n.Suspense,{fallback:null},Object(i.jsx)(Vt,Object(At.a)({},e,{intercepts:s}))),o()(a)?null:Object(i.jsx)(n.Suspense,{fallback:null},Object(i.jsx)(Pt,Object(At.a)({},e,{intercepts:a}))),o()(u)?null:Object(i.jsx)(n.Suspense,{fallback:null},Object(i.jsx)(wt,Object(At.a)({},e,{intercepts:u}))))};var xt=c.a.memo(Mt);var Ht=()=>{const[e,t]=Nt(),r=Object(n.useCallback)((e=>{t({type:Rt,payload:{interceptId:e}})}),[t]);return o()(e)?null:Object(i.jsx)(xt,{intercepts:e,onClose:r})},Ft=r(747),Wt=r(894);var $t=function(e){const t=Object(Wt.a)(e.window);return Object(i.jsx)(Ft.a.Provider,{value:t},e.children)},Bt=r(967),Qt=r(1063),Zt=r(705),Yt=r(704),zt=r(501);const Kt=e=>{const t=Object(w.b)(),r=Object(n.useMemo)((()=>Object(zt.a)(t.document)),[t.document]);return Object(i.jsx)(i.CacheProvider,{value:r},Object(i.jsx)($t,{window:t},Object(i.jsx)(Bt.a.Provider,{value:e.handshakeDetails},Object(i.jsx)(Qt.b,null,Object(i.jsx)(he,null,Object(i.jsx)(Zt.b,null,Object(i.jsx)(Yt.a,null,Object(i.jsx)(Ht,null))))))))};var Xt=c.a.memo(Kt),Jt=r(880);function qt(e,t){const r=Object(Jt.a)();s.a.render(Object(i.jsx)(Xt,{handshakeDetails:t}),r)}},260:function(e,t,r){"use strict";var n=r(191),c=r(314),a=r.n(c);const s="DATA_LOADING",i="DATA_LOADED",u="DATA_UPDATED",o="DATA_LOAD_FAILED",l="DATA_FETCHING_MORE",b={loading:!1,error:void 0,data:void 0},O=(e,t)=>{switch(t.type){case s:return{...e,loading:!0,data:void 0,error:void 0};case l:return{...e,loading:!0,error:void 0};case i:return{...e,loading:!1,data:t.payload};case o:return{...e,loading:!1,error:t.payload};case u:return{...e,data:t.payload};default:return e}};var d=()=>Object(n.useReducer)(O,b),E=r(223),T=r(266);const v=(e,t)=>t!==e.current;t.a=e=>{let{query:t,skipQueryOnMount:r,payload:c,onCompleted:b,mapFn:O,options:_}=e;const[I,j]=d(),{loading:f,data:h,error:C}=I,g=Object(n.useRef)(null),p=Object(n.useRef)(h);p.current=h;const m=E.a.getType(t),S=E.a.getUrl(t),R=Object(n.useRef)(b);R.current=b;const N=Object(n.useCallback)((()=>{g.current=null}),[]),A=Object(n.useCallback)((async(e,t)=>{N(),g.current=t;const r=await T.a[m](S,e,_);if(!v(g,t))return R.current&&R.current(r.data),r}),[m,S]),L=Object(n.useCallback)((async e=>{j({type:s,payload:{}});const t=a()("reqId");try{const n=await A(e,t);var r;if(!v(g,t))j({type:i,payload:null!==(r=null===O||void 0===O?void 0:O(n.data))&&void 0!==r?r:null===n||void 0===n?void 0:n.data})}catch(n){v(g,t)||j({type:o,payload:n})}}),[A]);Object(n.useEffect)((()=>{r||L(c)}),[]);const y=Object(n.useCallback)((async(e,t)=>{j({type:l,payload:{}});const r=a()("reqId");try{const c=await A(e,r);if(!v(g,r)){var n;let e=c.data;t&&(e=t(p.current,c.data)),j({type:i,payload:null!==(n=null===O||void 0===O?void 0:O(e))&&void 0!==n?n:e})}}catch(c){v(g,r)||j({type:o,payload:c})}}),[A]),D=Object(n.useCallback)((async(e,t)=>{t?await y(e,t):await L(e)}),[L]),k=Object(n.useCallback)((e=>{var t;const r=e(p.current);j({type:u,payload:null!==(t=null===O||void 0===O?void 0:O(r))&&void 0!==t?t:r})}),[]);return{loading:f,data:h,error:C,refetch:D,fetchMore:y,updateQuery:k}}},307:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));const n={PAGE_VISIT:"PAGE_VISIT",TAB_CHANGE:"TAB_CHANGE",TAB_CLOSE:"TAB_CLOSE",INTERCEPT_SNOOZE_TRIGGERED:"INTERCEPT_SNOOZE_TRIGGERED",INTERCEPT_TRIGGERED:"INTERCEPT_TRIGGERED",INTERCEPT_CLOSED:"INTERCEPT_CLOSED",INTERCEPT_ENGAGED:"INTERCEPT_ENGAGED",SNOOZE:"SNOOZE",INTERCEPT_TRIGGERED_IN_BACKGROUND:"INTERCEPT_TRIGGERED_IN_BACKGROUND",INTERCEPT_AUTO_CLOSED:"INTERCEPT_AUTO_CLOSED"}},321:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));const n={CLOSE:"CLOSE",ENGAGE:"ENGAGE",TRIGGERED:"TRIGGERED",SNOOZE:"SNOOZE"}},352:function(e,t,r){"use strict";r.d(t,"a",(function(){return j}));var n=r(1515),c=r(329),a=r(1062),s=r(1054),i=r(594),u=r(833);var o=Object(c.a)((function(e){return Object(s.a)((function(t){return function(e,t){for(var r=t,n=0;n<e.length;n+=1){if(null==r)return;var c=e[n];r=Object(i.a)(c)?Object(u.a)(c,r):r[c]}return r}(e,t)}),Object(a.a)(e))})),l=r(1407);const b=Object(n.a)("id"),O=Object(n.a)("creativeId"),d=Object(n.a)("targets"),E=o(["creative","socialAsset","content"]),T=Object(n.a)("settings"),v=Object(n.a)("filter"),_=Object(n.a)("snoozeConfig"),I=o(["additional","surveyResponseId"]);class j{}j.getId=Object(l.a)(b),j.getCreativeId=Object(l.a)(O),j.getTargets=Object(l.a)(d),j.getCreative=Object(l.a)(E),j.getFilter=Object(l.a)(v),j.getSettings=Object(l.a)(T),j.getSnoozeConfig=Object(l.a)(_),j.getSurveyResponseId=Object(l.a)(I)},363:function(e,t,r){"use strict";var n=r(191),c=r(1063);t.a=()=>Object(n.useContext)(c.a)},364:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));const n={LIVE_CHAT_ROUTE_TO_BOT:"LIVE_CHAT_ROUTE_TO_BOT",LIVE_CHAT_EXECUTE_RULE:"LIVE_CHAT_EXECUTE_RULE",LIVE_CHAT_WITH_AGENT:"LIVE_CHAT_WITH_AGENT",CLOSE:"CLOSE",SURVEY:"SURVEY",SURVEY_INLINE:"SURVEY_INLINE",CHAT_WITH_AGENT:"CHAT_WITH_AGENT",ROUTE_TO_BOT:"ROUTE_TO_BOT",EXECUTE_RULE:"EXECUTE_RULE",REMOVE:"REMOVE",SNOOZE:"SNOOZE",URL:"OPEN_URL",AUDIO_CALL:"AUDIO_CALL",VIDEO_CALL:"VIDEO_CALL",OPEN_LAST_CONVERSATION:"OPEN_LAST_CONVERSATION"}},399:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(191),c=r(9);const a=()=>{const[e,t]=Object(n.useState)(Object(c.d)());return Object(n.useEffect)((()=>{const e=()=>{const e=Object(c.d)();e||t(!1),e&&t(!0)};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}}),[]),e}},507:function(e,t,r){"use strict";var n=r(191),c=r(31),a=r.n(c),s=r(355),i=r.n(s),u=r(290),o=r.n(u),l=r(260),b=r(399),O=r(745),d=r(223),E=r(52),T=r(240),v=r(307);const _=(new d.a).setUrl("/livechat/prompt/browse/event").setType(T.a.POST).build(),I=(()=>{const e={};return{set:(t,r)=>{e[r]=t},get:t=>e[t],push:(t,r)=>{var n;e[r]=[...null!==(n=e[r])&&void 0!==n?n:[],...o()(t)]}}})(),j=e=>({...e,sourceType:"PROACTIVE_PROMPT",page:Object(E.a)().pageUrl,timeZone:Object(E.a)().timeZone,userAgent:Object(E.a)().userAgent});t.a=function(){let{skipQueryOnMount:e,payload:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{skipQueryOnMount:!1};const{refetch:r,...c}=Object(l.a)({query:_,skipQueryOnMount:e,payload:t?j(t):void 0}),s=Object(O.a)(),u=s.chatUser.userId,o=Object(b.a)(),d=Object(n.useRef)(o);d.current=o;const E=Object(n.useCallback)((e=>{const t=j(e);if(d.current)r(t);else if(t.eventType===v.a.INTERCEPT_AUTO_CLOSED){const e=i()(I.get(u),(e=>e.eventId===t.eventId&&e.eventType===v.a.INTERCEPT_TRIGGERED));-1!==e&&I.get(u).splice(e,1),I.push(t,u)}else t.eventType===v.a.INTERCEPT_TRIGGERED&&r({...t,eventType:v.a.INTERCEPT_TRIGGERED_IN_BACKGROUND}),I.push(t,u)}),[r,u]);return Object(n.useEffect)((()=>{o&&!a()(I.get(u))&&window.setTimeout((()=>{a()(I.get(u))||(r(I.get(u)),I.set([],u))}),0)}),[o]),{...c,refetch:E}}},508:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var n=r(1515),c=r(1407);const a=Object(n.a)("type"),s=Object(n.a)("value"),i=Object(n.a)("additional");class u{}u.getType=Object(c.a)(a),u.getValue=Object(c.a)(s),u.getAdditional=Object(c.a)(i)},547:function(e,t,r){"use strict";function n(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return e?r:[]}r.d(t,"a",(function(){return n}))},745:function(e,t,r){"use strict";var n=r(191),c=r(967);t.a=()=>Object(n.useContext)(c.a)},746:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r(1515),c=r(1407);const a=Object(n.a)("type");class s{}s.getType=Object(c.a)(a)},747:function(e,t,r){"use strict";var n=r(191);const c=r.n(n).a.createContext({height:0,width:0});t.a=c},967:function(e,t,r){"use strict";var n=r(191);const c=r.n(n).a.createContext(void 0);t.a=c},968:function(e,t,r){var n=r(56),c=r(1354),a=r(53),s=r(86),i=r(1355),u=r(251),o=s((function(e){var t=u(e),r=n(e,i);return t===u(r)?t=void 0:r.pop(),r.length&&r[0]===e[0]?c(r,a(t,2)):[]}));e.exports=o}}]);